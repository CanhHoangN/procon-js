<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Render Map</title>
    <link rel="stylesheet" href="../cssProcon/css.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../css/bootstrap.css">
    <script src="../js/bootstrap.js"></script>

    <style>
        .map{


        }

    </style>
</head>

<body>
    <div class="container">
        <div class="map">
            <ul>
            </ul>
        </div>
        <div class="actionAgent col-sm-4">
            <form action="#" method="post">
                <span>AgentID</span>
                <label for="agentid"></label><input class="form-control" type="text" name="agentid" id="agentid">
                <span>Dx</span>
                <label for="dx"></label><input class="form-control" type="text" name="dx" id="dx">
                <span>Dy</span>
                <label for="dy"></label><input class="form-control" type="text" name="dy" id="dy">
                <span>Type</span><br>
                <label>
                    <select>
                       <option value="move">move</option>
                        <option value="remove">remove</option>
                        <option value="stay">stay</option>
                    </select>
                </label><br>
                <input class="btn-primary" type="submit" value="submit">


            </form>
        </div>
        <div class="demo">
            <br>
            <button id="action">action</button>
        </div>
    </div>
<script>
    // get token roi dan vao day
    var token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjoidGVhbTEiLCJpYXQiOjE1NzAwMjc4NjAsImV4cCI6MTU3MDAzNTA2MH0.cv2I8Kz5yhrIvzIpiNH-440d2rUzHjzV0HveNtj3W_c";
    var prevGame = [
        {
            "id": 0,
            "intervalMillis": 0,
            "matchTo": "string",
            "teamID": 0,
            "turnMillis": 0,
            "turns": 0
        }
    ];
    var statusNow = {
        "actions": [
            {
                "agentID": 0,
                "dx": 0,
                "dy": 0,
                "type": "move",
                "apply": -1,
                "turn": 0
            }
        ],
        "height": 0,
        "points": [
            [
                0
            ]
        ],
        "startedAtUnixTime": 0,
        "teams": [
            {
                "agents": [
                    {
                        "agentID": 0,
                        "x": 0,
                        "y": 0
                    }
                ],
                "areaPoint": 0,
                "teamID": 0,
                "tilePoint": 0
            }
        ],
        "tiled": [
            [
                0
            ]
        ],
        "turn": 0,
        "width": 0
    };
    var postStatusAgent ={
        "actions": [
            {
                "agentID": 0,
                "dx": 0,
                "dy": 0,
                "type": "move"
            }
        ]
    };



    $(document).ready(function () {
        var json = {};

        function getJson(data){
            json = data;
        }
        var arrId = function(){
            var arr =[];
            $.ajax({
                async: false,
                url: 'http://sv-procon.uet.vnu.edu.vn:3000/matches',
                type:'GET',
                dateType:'json',
                headers: {"Authorization":token},
                success:function (data) {
                    console.log(data);
                    arr = data;
                },
                error:function (error) {
                    console.log(error);
                }

            });
            return arr;

        }();

        var id = arrId[0].id;
        console.log("id "+id);
        function getState(){
            var res = null;
            $.ajax({
                async: false,
                url: 'http://sv-procon.uet.vnu.edu.vn:3000/matches/'.concat(id+"'"),
                type:'GET',
                dateType:'json',
                headers: {"Authorization":token},
                success:function (data) {
                    console.log(data);
                    res = data;
                },
                error:function (error) {
                    console.log(error);
                }

            });
            return res;
        }
        json = getState();
        // console.log("asdas"+json.points);
        var json1= {
            "actions": [
                {
                    "agentID": 1,
                    "type": "move",
                    "dx": -1,
                    "dy": -1,
                    "turn": 1
                },
                {
                    "agentID": 2,
                    "type": "move",
                    "dx": -1,
                    "dy": -1
                }
            ]
        };

        function postAction(){
            $.ajax({
                url: 'http://sv-procon.uet.vnu.edu.vn:3000/matches/'.concat(id+'/action'),
                type:'POST',
                dateType:'json',
                contentType: 'application/json',
                data:JSON.stringify(json1),
                headers: {"Authorization":token},
                success:function (data) {
                    console.log(data);
                },
                error:function (error) {
                    console.log(error);
                }
            });
        }
        $('#action').click(function () {
            postAction();
            json = getState();
            location.reload();


        });
        var actionTeamOne = {};
        var actionTeamTwo = {};

        var cl = '';
        var color = '';
        var bol = false;
        var agentsTeamOne = json.teams[0].agents;
        var agentsTeamTwo = json.teams[1].agents;
        var idTeamOne = json.teams[0].teamID;
        var idTeamTwo = json.teams[1].teamID;
        // idTeamTwo =json.teams[1];
        //console.log(agentsTeamOne);
        var tiled = json.tiled;
        // console.log(tiled);
        var value ;
        var pointsAgent ;
        //console.log(agentsTeamOne[0].x;
        var vtAgentTeamOne = [];
        var vtAgentTeamTwo = [];
        var pointElTeamOne = 1;
        var pointElTeamTwo = 1;
       /* for(var i = 0 ; i < agentsTeamOne.length; i++){
            prevAgentsTeamOne.push([agentsTeamTwo[i].x,agentsTeamTwo[i].y]);
            prevAgentsTeamTwo.push([agentsTeamOne[i].x,agentsTeamOne[i].y]);
        }*/

        $(".map").css({
            width:json.width*40+json.width*2+40,
            height: json.height*35+json.height*2
        });
        for(var i = 0 ; i < json.height ; i++){
            for(var j = 0 ; j < json.width ; j++){
                if(tiled[i][j] === idTeamOne){
                    cl = "el elTeamOne";
                    $("ul").append("<li"+ " class="+"'"+cl+"'" +" style='width: 40px;float:left'"+" value="+"'"+pointElTeamOne.toString()+"'>".concat("("+pointElTeamOne+")"+json.points[i][j]+"</li>"));
                    pointElTeamOne++;
                }else if(tiled[i][j] === idTeamTwo){
                    cl = "el elTeamTwo";
                    $("ul").append("<li"+ " class="+"'"+cl+"'" +" style='width: 40px;float:left'"+" value="+"'"+i.toString()+j.toString()+"'>".concat("("+pointElTeamTwo+")"+json.points[i][j]+"</li>"));
                    pointElTeamTwo++;
                }else{
                    cl = "el";
                    $("ul").append("<li"+ " class="+"'"+cl+"'" +" style='width: 40px;float:left'"+" value="+"'"+i.toString()+j.toString()+"'>".concat(json.points[i][j]+"</li>"));
                }


            }

        }

       /* $("li").click(function () {
            $('li[value='+value+']').removeClass('stayHere');

            var point = $(this).attr('value');
            if(bol === true){
                $(this).addClass("elTeamOne stayHere");
                $(this).attr({
                    value:pointsAgent
                })
            }
            bol = false;
            value = $(this).attr('value');
        });

        $('li').click(function () {
            //alert($(this).attr('value'));
            $('#agentid').attr({
                value:$(this).attr('value')
            })
        });
        $('#action').click(function(){
            var obj =
                {
                    "actions": [
                        {
                            "agentID": $('#agentid').val(),
                            "dx": $('#dx').val(),
                            "dy": $('#dy').val(),
                            "type": $('select').val()
                        }
                    ]
                };
            console.log(JSON.stringify(obj));
        });*/


    });
</script>
</body>
</html>